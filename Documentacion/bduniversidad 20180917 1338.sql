-- Script was generated by Devart dbForge Studio for MySQL, Version 6.0.128.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 9/17/2018 1:38:39 PM
-- Server version: 5.5.5-10.1.34-MariaDB
-- Client version: 4.1

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

-- 
-- Set default database
--
USE bduniversidad;

--
-- Definition for table materia
--
DROP TABLE IF EXISTS materia;
CREATE TABLE materia (
  IdMateria INT(11) NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(255) NOT NULL,
  CostoCreditos INT(11) NOT NULL,
  Duracion_Dias INT(11) NOT NULL,
  PRIMARY KEY (IdMateria)
)
ENGINE = INNODB
AUTO_INCREMENT = 7
AVG_ROW_LENGTH = 4096
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for table persona
--
DROP TABLE IF EXISTS persona;
CREATE TABLE persona (
  IdPersona INT(11) NOT NULL AUTO_INCREMENT,
  nombre VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  direccion VARCHAR(255) NOT NULL,
  PRIMARY KEY (IdPersona)
)
ENGINE = INNODB
AUTO_INCREMENT = 8
AVG_ROW_LENGTH = 2340
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for table docente
--
DROP TABLE IF EXISTS docente;
CREATE TABLE docente (
  IdDocente INT(11) NOT NULL AUTO_INCREMENT,
  IdPersona INT(11) NOT NULL,
  Username VARCHAR(255) NOT NULL,
  Password VARCHAR(255) NOT NULL,
  PRIMARY KEY (IdDocente),
  CONSTRAINT IdDIdP FOREIGN KEY (IdPersona)
    REFERENCES persona(IdPersona) ON DELETE NO ACTION ON UPDATE NO ACTION
)
ENGINE = INNODB
AUTO_INCREMENT = 4
AVG_ROW_LENGTH = 8192
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for table estudiante
--
DROP TABLE IF EXISTS estudiante;
CREATE TABLE estudiante (
  IdEstudiante INT(11) NOT NULL AUTO_INCREMENT,
  IdPersona INT(11) NOT NULL,
  PRIMARY KEY (IdEstudiante),
  CONSTRAINT IdPIdE FOREIGN KEY (IdPersona)
    REFERENCES persona(IdPersona) ON DELETE NO ACTION ON UPDATE NO ACTION
)
ENGINE = INNODB
AUTO_INCREMENT = 6
AVG_ROW_LENGTH = 3276
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for table grupo
--
DROP TABLE IF EXISTS grupo;
CREATE TABLE grupo (
  IdGrupo INT(11) NOT NULL AUTO_INCREMENT,
  IdMateria INT(11) NOT NULL,
  IdDocente INT(11) NOT NULL,
  FechaInicio DATE NOT NULL,
  FechaFin DATE NOT NULL,
  PRIMARY KEY (IdGrupo),
  CONSTRAINT IdDIdG FOREIGN KEY (IdDocente)
    REFERENCES docente(IdDocente) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT IdMIdG FOREIGN KEY (IdMateria)
    REFERENCES materia(IdMateria) ON DELETE NO ACTION ON UPDATE NO ACTION
)
ENGINE = INNODB
AUTO_INCREMENT = 5
AVG_ROW_LENGTH = 4096
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for table pagos
--
DROP TABLE IF EXISTS pagos;
CREATE TABLE pagos (
  IdPago INT(11) NOT NULL AUTO_INCREMENT,
  IdEstudiante INT(11) NOT NULL,
  creditos INT(11) NOT NULL,
  costo DOUBLE NOT NULL,
  PRIMARY KEY (IdPago),
  CONSTRAINT IdEIdPago FOREIGN KEY (IdEstudiante)
    REFERENCES estudiante(IdEstudiante) ON DELETE NO ACTION ON UPDATE NO ACTION
)
ENGINE = INNODB
AUTO_INCREMENT = 10
AVG_ROW_LENGTH = 3276
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for table clase
--
DROP TABLE IF EXISTS clase;
CREATE TABLE clase (
  IdGrupo INT(11) NOT NULL,
  IdEstudiante INT(11) NOT NULL,
  Nota INT(11) NOT NULL,
  CONSTRAINT IdEIdC FOREIGN KEY (IdEstudiante)
    REFERENCES estudiante(IdEstudiante) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT IdGIdC FOREIGN KEY (IdGrupo)
    REFERENCES grupo(IdGrupo) ON DELETE NO ACTION ON UPDATE NO ACTION
)
ENGINE = INNODB
AVG_ROW_LENGTH = 4096
CHARACTER SET latin1
COLLATE latin1_swedish_ci;

--
-- Definition for view gastoscreditosestudiante
--
DROP VIEW IF EXISTS gastoscreditosestudiante CASCADE;
CREATE OR REPLACE 
	DEFINER = 'root'@'localhost'
VIEW gastoscreditosestudiante
AS
	select `estudiante`.`IdEstudiante` AS `IdEstudiante`,`persona`.`nombre` AS `nombre`,sum(`materia`.`CostoCreditos`) AS `gasto` from ((((`estudiante` join `clase`) join `grupo`) join `materia`) join `persona`) where ((`materia`.`IdMateria` = `grupo`.`IdMateria`) and (`grupo`.`IdGrupo` = `clase`.`IdGrupo`) and (`estudiante`.`IdEstudiante` = `clase`.`IdEstudiante`) and (`estudiante`.`IdPersona` = `persona`.`IdPersona`)) group by `persona`.`nombre`;

-- 
-- Dumping data for table materia
--
INSERT INTO materia VALUES
(1, 'Calculo', 4, 45),
(2, 'Programacion', 4, 45),
(3, 'fisica', 3, 30),
(4, 'Comunicacion', 2, 20),
(6, 'Test', 5, 50);

-- 
-- Dumping data for table persona
--
INSERT INTO persona VALUES
(1, 'pablo', 'pablo97@gmail.com', 'juliorodriguez'),
(2, 'mateo', 'mateo@@yhoo.com', 'santa cruz'),
(3, 'josue', 'josuecardozo@gmail.com', 'pacata'),
(4, 'pedro', 'pedro@live.com', 'circunvalacion'),
(5, 'marcelo', 'marcelo@gmail.com', 'capitan uztariz'),
(6, 'Alejandro', 'almenese@gmail.com', 'blanco galindo '),
(7, 'Marcel', 'marcelBarrero@upb.edu', 'capitan ustariz');

-- 
-- Dumping data for table docente
--
INSERT INTO docente VALUES
(1, 3, 'Dodovrosky', 'nada'),
(2, 5, 'DeLaTorre', 'algo'),
(3, 4, '123', '123');

-- 
-- Dumping data for table estudiante
--
INSERT INTO estudiante VALUES
(1, 1),
(2, 2),
(4, 3),
(3, 4),
(5, 5);

-- 
-- Dumping data for table grupo
--
INSERT INTO grupo VALUES
(1, 2, 2, '2018-09-11', '2018-10-17'),
(2, 4, 1, '2018-09-26', '2018-10-25'),
(3, 1, 3, '2018-09-18', '2018-09-29'),
(4, 3, 1, '2018-11-01', '2018-12-19');

-- 
-- Dumping data for table pagos
--
INSERT INTO pagos VALUES
(1, 1, 4, 2530.7),
(2, 3, 3, 2150.5),
(3, 2, 5, 2830),
(8, 2, 6, 3200),
(9, 4, 0, 0);

-- 
-- Dumping data for table clase
--
INSERT INTO clase VALUES
(1, 2, 59),
(2, 3, 89),
(1, 1, 100),
(3, 2, 48),
(4, 1, 50);

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;